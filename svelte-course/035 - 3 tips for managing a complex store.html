<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="/Tutorials/favicon.png" />
  <link rel="stylesheet" href="/Tutorials/prism-vsc-dark-plus.css">
  <meta name="viewport" content="width=device-width" />
  <meta http-equiv="content-security-policy" content="">
		<link href="/Tutorials/_app/immutable/assets/_layout-834a5097.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/mdsvex-layout-notes-6cb1985e.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/Strong-aa452a7b.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/Example-332e9834.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/HelloWorld_1-e8530f87.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-fea723ac.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/HelloWorld_1-d771becf.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/PAttack-335b6bab.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-68192e0c.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-8a46b28a.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-534beb13.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/ShowCode-55a0cfff.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-2fa50034.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-9f516fc6.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-c186df43.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/ShowMany-c90398c8.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-1b9f34c9.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-50d68a3c.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-8e5653e3.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-3a25cb44.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-3922611a.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_page-7c9efb43.css" rel="stylesheet">
		<link href="/Tutorials/_app/immutable/assets/_Example-bd8a81fe.css" rel="stylesheet">
		<link rel="modulepreload" href="/Tutorials/_app/immutable/start-22982d30.js">
		<link rel="modulepreload" href="/Tutorials/_app/immutable/chunks/index-58af1356.js">
		<link rel="modulepreload" href="/Tutorials/_app/immutable/chunks/singletons-e74dbb43.js">
		<link rel="modulepreload" href="/Tutorials/_app/immutable/chunks/index-be13bd0b.js">
		<link rel="modulepreload" href="/Tutorials/_app/immutable/chunks/paths-b4419565.js">
		<link rel="modulepreload" href="/Tutorials/_app/immutable/chunks/preload-helper-41c905a7.js">
		<link rel="modulepreload" href="/Tutorials/_app/immutable/components/pages/_layout.svelte-267d9395.js">
		<link rel="modulepreload" href="/Tutorials/_app/immutable/components/pages/svelte-course/_slug_/_page.svelte-473cf8be.js">
		<link rel="modulepreload" href="/Tutorials/_app/immutable/modules/pages/svelte-course/_slug_/_page.js-d6d9da0b.js">
		<link rel="modulepreload" href="/Tutorials/_app/immutable/chunks/dynamic-import-helper-be004503.js">
		<link rel="modulepreload" href="/Tutorials/_app/immutable/chunks/_page-9ad949ed.js">
</head>

<body>
  <div>


<nav class="svelte-1idopbc"><a class="uno-qz86gb svelte-1idopbc" href="/Tutorials/">Home </a>
	<a class="uno-kk5pwl svelte-1idopbc" href="/Tutorials/svelte-course">Svelte Course
	</a></nav>

<div class="uno-hk8nma svelte-1idopbc"><p class="uno-lsveny svelte-1idopbc">Warning!</p>
	<p class="uno-51bdnx svelte-1idopbc">under construction :)</p></div>

<nav><ul><li><a href="/Tutorials/svelte-course/0 - Introduction">0 - Introduction</a>
					</li><li><a href="/Tutorials/svelte-course/000 - Writing your first Svelte component">000 - Writing your first Svelte component</a>
					</li><li><a href="/Tutorials/svelte-course/001 - Style your Svelte component">001 - Style your Svelte component</a>
					</li><li><a href="/Tutorials/svelte-course/002 - Adding data to your Svelte component">002 - Adding data to your Svelte component</a>
					</li><li><a href="/Tutorials/svelte-course/003 - Reactivity in Svelte">003 - Reactivity in Svelte</a>
					</li><li><a href="/Tutorials/svelte-course/004 - Attaching events in Svelte">004 - Attaching events in Svelte</a>
					</li><li><a href="/Tutorials/svelte-course/005 - Reactive declarations and statements">005 - Reactive declarations and statements</a>
					</li><li><a href="/Tutorials/svelte-course/006 - tick()">006 - tick()</a>
					</li><li><a href="/Tutorials/svelte-course/007 - Components and props">007 - Components and props</a>
					</li><li><a href="/Tutorials/svelte-course/008 - Component events">008 - Component events</a>
					</li><li><a href="/Tutorials/svelte-course/009 - Forwarding component events">009 - Forwarding component events</a>
					</li><li><a href="/Tutorials/svelte-course/010 - class directive">010 - class directive</a>
					</li><li><a href="/Tutorials/svelte-course/011 - Bindings">011 - Bindings</a>
					</li><li><a href="/Tutorials/svelte-course/012 - bind group">012 - bind group</a>
					</li><li><a href="/Tutorials/svelte-course/013 - bind this">013 - bind this</a>
					</li><li><a href="/Tutorials/svelte-course/014 - Component lifecycle events">014 - Component lifecycle events</a>
					</li><li><a href="/Tutorials/svelte-course/015 - onMount()">015 - onMount()</a>
					</li><li><a href="/Tutorials/svelte-course/016 - if">016 - if</a>
					</li><li><a href="/Tutorials/svelte-course/017 - each">017 - each</a>
					</li><li><a href="/Tutorials/svelte-course/018 - keyed each">018 - keyed each</a>
					</li><li><a href="/Tutorials/svelte-course/019 - await">019 - await</a>
					</li><li><a href="/Tutorials/svelte-course/020 - key">020 - key</a>
					</li><li><a href="/Tutorials/svelte-course/021 - getContext">021 - getContext</a>
					</li><li><a href="/Tutorials/svelte-course/022 - Communicating through context">022 - Communicating through context</a>
					</li><li><a href="/Tutorials/svelte-course/023 - Intro to Svelte store">023 - Intro to Svelte store</a>
					</li><li><a href="/Tutorials/svelte-course/024 - writable store">024 - writable store</a>
					</li><li><a href="/Tutorials/svelte-course/025 - readable store">025 - readable store</a>
					</li><li><a href="/Tutorials/svelte-course/026 - Svelte store contract">026 - Svelte store contract</a>
					</li><li><a href="/Tutorials/svelte-course/027 - DOM events as a Svelte store">027 - DOM events as a Svelte store</a>
					</li><li><a href="/Tutorials/svelte-course/028 - derived() Svelte store">028 - derived() Svelte store</a>
					</li><li><a href="/Tutorials/svelte-course/029 - tweened() Svelte store">029 - tweened() Svelte store</a>
					</li><li><a href="/Tutorials/svelte-course/030 - tweened() and spring()">030 - tweened() and spring()</a>
					</li><li><a href="/Tutorials/svelte-course/031 - Higher order store">031 - Higher order store</a>
					</li><li><a href="/Tutorials/svelte-course/032 - Reactive class property using stores">032 - Reactive class property using stores</a>
					</li><li><a href="/Tutorials/svelte-course/033 - Undo redo with Svelte store">033 - Undo redo with Svelte store</a>
					</li><li><a href="/Tutorials/svelte-course/034 - Reactive context">034 - Reactive context</a>
					</li><li><a href="/Tutorials/svelte-course/035 - 3 tips for managing a complex store">035 - 3 tips for managing a complex store</a>
					</li><li><a href="/Tutorials/svelte-course/036 - get() Svelte store value">036 - get() Svelte store value</a>
					</li><li><a href="/Tutorials/svelte-course/037 - store vs context">037 - store vs context</a>
					</li><li><a href="/Tutorials/svelte-course/038 - Intro to Svelte action">038 - Intro to Svelte action</a>
					</li></ul></nav>




<article class="uno-9uf4sf"><section class="uno-otf0eq"><div class="uno-xj1z8i"><h2 class="uno-sjqek6">3 tips for managing a complex store
</h2></div>
    <div class="uno-mexwlg"><p class="uno-ddg7b5 text-1xl ">Posted on 2023-03-31 by
</p>
      <a class="uno-bz4u3f text-1xl" href="http://github.com/henrikvilhelmberglund/">henrikvilhelmberglund
</a></div></section>
  <section class="uno-2adsix"><p class="uno-ddg7b5 text-1xl ">Managing a complex store can be tricky and Li Hau Tan has 3 tips for optimizing complex stores.
</p>
<p class="uno-ddg7b5 text-1xl ">Let&#39;s begin by showing a demo application.
</p>




<div class="uno-djcb2y text-1xl"><!-- HTML_TAG_START -->This kind of works but we have a problem. Whenever we add 3 todos, all of them disappear!<!-- HTML_TAG_END --></div>

<div class="uno-ndww0d"><div class="uno-a5c347"><navbar class="svelte-1qedsae"><div class="title svelte-1qedsae">Complex store example</div>
	<div class="count todos svelte-1qedsae">0 / 1</div>
	
	<div>Henrik</div>

	<div class="icon svelte-1y29kn9">âš™</div>

</navbar>

<div class="status svelte-1j7qay4">Done: 0 / 1</div>

<ul class="svelte-1j7qay4"><li class="svelte-1j7qay4"><input type="checkbox"  disabled class="svelte-1j7qay4">Do laundry</li>
		
		<button >Done</button>
		<button>Delete</button></ul>

<div class="svelte-1ook6qp">Add todo
	<form class="svelte-1ook6qp"><input value="">
		<button disabled type="submit">Add</button></form>
</div></div>

	<div class="uno-u9dsbt"><button class="uno-ahiawh">ðŸ”¼</button>
		<label class="uno-aeiywr uno-2y2hkt"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]" checked>App
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">AddTodo
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">EditProfile
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">Navbar
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">Notification
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">TodoList
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">data.js
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">markUpdate.js
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">wait.js
			</label>
		<pre class="uno-2zodpv language-svelte"><code style="font-family: 'Maple', Menlo, Monaco, Consolas, 'Andale Mono', 'Ubuntu Mono', 'Courier New', monospace;"><!-- HTML_TAG_START --><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">import</span> Navbar <span class="token keyword">from</span> <span class="token string">"./Navbar.svelte"</span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> TodoList <span class="token keyword">from</span> <span class="token string">"./TodoList.svelte"</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Navbar</span> <span class="token punctuation">/></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TodoList</span> <span class="token punctuation">/></span></span>
<!-- HTML_TAG_END --></code>
      </pre></div>
</div>
<p class="uno-ddg7b5 text-1xl ">First off, we are using markUpdate.js which shows where our states are getting updated by showing them with a red border. We can see this causes a problem because changing our profile name changes the state everywhere even though the profile name doesn&#39;t really have anything to do with the todos or notifications. This is also something we can improve.
</p>
<p class="uno-ddg7b5 text-1xl ">For the bug itself we can search for <code>$data.todos</code> and see where we are changing it, but we don&#39;t find the bug that wayâ€¦ ðŸ˜µ
</p>
<p class="uno-ddg7b5 text-1xl ">Debugging complex stores like this can be very hard since we can change the store from <strong class="uno-9ygim0">all components
</strong> in basically <strong class="uno-9ygim0">any way we like
</strong>.
</p>
<p class="uno-ddg7b5 text-1xl ">One way we could improve this is to introduce an <strong class="uno-9ygim0">action
</strong> that is the only thing that is allowed to edit the store. If we do this we can trace and find from where the action to edit the store came from.
</p>
<p class="uno-ddg7b5 text-1xl ">Our error is in the component <strong class="uno-9ygim0">Notification
</strong> where we left in some debugging code by mistake:
</p>




<div class="uno-djcb2y text-1xl"><!-- HTML_TAG_START -->We found our problem!<!-- HTML_TAG_END --></div>

<div class="uno-ndww0d"><div class="uno-a5c347"></div>

	<div class="uno-u9dsbt"><button class="uno-ahiawh">ðŸ”¼</button>
		<label class="uno-aeiywr uno-2y2hkt"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]" checked>excerpt from Notification
			</label>
		<pre class="uno-2zodpv language-svelte"><code style="font-family: 'Maple', Menlo, Monaco, Consolas, 'Andale Mono', 'Ubuntu Mono', 'Courier New', monospace;"><!-- HTML_TAG_START --><span class="token comment">&lt;!-- 
  if ($data.notifications.length === 3) $data = { ...$data, todos: [] };
 --></span>
<!-- HTML_TAG_END --></code>
      </pre></div>
</div>
<p class="uno-ddg7b5 text-1xl ">Let&#39;s make a better version of our app by:
</p>
<ul class="uno-kgkl12"><li class="uno-yaaaza text-1xl">making smaller stores, for example user doesn&#39;t need to be in the main store
</li>
<li class="uno-yaaaza text-1xl">creating derived stores for things that only require small things like &quot;length of todos&quot; to avoid extra update cycles
</li>
<li class="uno-yaaaza text-1xl">putting all our functions that modify the store <strong class="uno-9ygim0">in one place
</strong>!
</li>
</ul>






<div class="uno-ndww0d"><div class="uno-a5c347"><navbar class="svelte-1qedsae"><div class="title svelte-1qedsae">Complex store example</div>
	<div class="count todos svelte-1qedsae">0 / 1</div>
	
	<div>Henrik</div>

	<div class="icon svelte-1y29kn9">âš™</div>

</navbar>

<div class="status svelte-1j7qay4">Done: 0 / 1</div>

<ul class="svelte-1j7qay4"><li class="svelte-1j7qay4"><input type="checkbox"  disabled class="svelte-1j7qay4">Do laundry</li>
		
		<button >Done</button>
		<button>Delete</button></ul>

<div class="svelte-1ook6qp">Add todo
	<form class="svelte-1ook6qp"><input value="">
		<button disabled type="submit">Add</button></form>
</div></div>

	<div class="uno-u9dsbt"><button class="uno-ahiawh">ðŸ”¼</button>
		<label class="uno-aeiywr uno-2y2hkt"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]" checked>App2
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">AddTodo2
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">EditProfile2
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">Navbar2
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">Notification2
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">TodoList2
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">data2.js
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">markUpdate2.js
			</label><label class="uno-aeiywr uno-blin5q"><input type="radio" name="selected" class="uno-pdic65" id="" value="[object Object]">wait2.js
			</label>
		<pre class="uno-2zodpv language-svelte"><code style="font-family: 'Maple', Menlo, Monaco, Consolas, 'Andale Mono', 'Ubuntu Mono', 'Courier New', monospace;"><!-- HTML_TAG_START --><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">import</span> Navbar2 <span class="token keyword">from</span> <span class="token string">"./Navbar2.svelte"</span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> TodoList2 <span class="token keyword">from</span> <span class="token string">"./TodoList2.svelte"</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Navbar2</span> <span class="token punctuation">/></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TodoList2</span> <span class="token punctuation">/></span></span>
<!-- HTML_TAG_END --></code>
      </pre></div>
</div>
<p class="uno-ddg7b5 text-1xl ">After editing data2.js we can see that adding a smaller user store helped because now when we edit the user name <strong class="uno-9ygim0">only the navbar updates
</strong>.
</p>
<p class="uno-ddg7b5 text-1xl ">In the same way when toggling a todo to be done the <strong class="uno-9ygim0">navbar doesn&#39;t update
</strong> because we&#39;re using <strong class="uno-9ygim0">derived stores for the smaller .length and so data
</strong>.
</p>
<p class="uno-ddg7b5 text-1xl ">Here are Li Hau Tan&#39;s tips:
</p>
<h3 class="uno-k2n0uo">Tip 1:
</h3>
<p class="uno-ddg7b5 text-1xl ">If you have a complex state, avoid manipulating the writable store directly.
</p>
<p class="uno-ddg7b5 text-1xl ">Use state management libraries, such as state machines or reducers to help manage the state changes.
</p>
<h3 class="uno-k2n0uo">Tip 2:
</h3>
<p class="uno-ddg7b5 text-1xl ">Have a small self-contained store.
</p>
<h3 class="uno-k2n0uo">Tip 3:
</h3>
<p class="uno-ddg7b5 text-1xl ">If you have a large store, create a derived store out of it, so your component does not have to subscribe to all changes made to the store.
</p>
<p class="uno-ddg7b5 text-1xl ">Making the store immutable or proxy-based can allow us to subscribe to part of the store too!
</p></section></article>


		<script type="module" data-sveltekit-hydrate="j1j0f5">
			import { start } from "/Tutorials/_app/immutable/start-22982d30.js";

			start({
				env: {},
				paths: {"base":"/Tutorials","assets":"/Tutorials"},
				target: document.querySelector('[data-sveltekit-hydrate="j1j0f5"]').parentNode,
				version: "1680435401656",
				hydrate: {
					node_ids: [0, 5],
					data: [null,null],
					form: null
				}
			});
		</script>
	</div>
</body>

</html>